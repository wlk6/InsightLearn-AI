<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="stylesheet" href="assets/css/main.css">
<link rel="stylesheet" href="assets/css/responsive.css">
<link rel="stylesheet" href="assets/css/work.css">
<link rel="stylesheet" href="assets/css/button.css">
</head>
<body>
<!-- Start Preload -->
<div class="preloader"></div>
<div class="block-1"></div>
<div class="block-2"></div>
<div class="logo-load"><img src="assets/img/logo1.svg" alt=""></div>
<div class="logo-load spinning"></div>
<div class="over-all"></div>
<!-- End Preload -->
<!-- Start Header -->
<header>
  <nav><!-- Logo -->
    <div class="logo hover-target"><a class="load-spiral" href="../../oo/index.html"><img src="assets/img/logo.svg" alt="logo"></a></div>
    <!-- Menu bar -->
    <div class="toggle-btn magnetic hover-target">
      <div class="burger-menu"><span class="one"></span><span class="two"></span><span class="tre"></span></div>
    </div>
    <!-- Social -->
    <div class="scr socials">
      <div class="list-social">
        <ul>
            <li class="hover-target"><a href="#">COUSE.</a></li>
            <li class="hover-target"><a href="#">R.</a></li>
            <li class="hover-target"><a href="#">Q.</a></li>
            <li class="hover-target"><a href="#">A.</a></li>
        </ul>
      </div>
    </div>
    <!-- Copyright -->
    <div class="scr copyright-top">
      <p>教育 &copy;2024</p>
    </div>
    <div class="bg-nav"></div>
    <!-- menu -->
    <div class="manu-container">
        <div class="menu">
          <div class="data">
            <div class="container">
              <div class="row">
                <div class="col-md-6">
                  <div class="links text-center text-lg-left">
                    <ul>
                      <li>
                        <p>01</p>
                        <a class="menu-link hover-target load-spiral" href="index-2.html">收藏</a></li>
                      <li>
                        <p>02</p>
                        <a class="menu-link hover-target load-spiral" href="index-3.html">喜欢</a></li>
                      <li>
                        <p>03</p>
                        <a class="menu-link hover-target load-spiral" href="work.html">浏览记录</a></li>
                      <li>
                        <p>04</p>
                        <a class="menu-link hover-target load-spiral" href="work-detail.html">离线缓存</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </nav>
</header>
<!-- End Header -->
<!-- Start Content -->
<div id="spiral"><!-- Header -->
  <div class="scrolls"><img draggable="false" src="assets/img/sroll.svg" alt="scroll"></div>
  <div class="main-head centered luxy-el" data-speed-y="5" data-offset="0">
    <div id="headmove"></div>
    <div class="bg-detail-blog"></div>
    <div class="container">
      <div class="row">
        <div class="col-md-8 offset-md-2">
          <h3 class="detail-pinyin"style="letter-spacing: 7px;">liú lǎn lì shǐ</h3>
          <h3 class="detail-title">浏 览 历 史</h3>
          <h3 class="detail-title">Browse History</h3>
        </div>
      </div>
    </div>
  </div>
  <section class="bg-darks">
    <div class="head"id="epp">
      <div class="head-left">
        <h1>历史记录</h1>
      </div>
      <div class="head-right">
        <div class="search-right">
          <input id="searchInput" type="text" placeholder="搜索历史记录"v-model="searchKeyword" @keyup.enter="handleSearch">
          <img id="searchButton"src="../../oo/image/glasses.png" @click="handleSearch" alt=""/>
        </div>
        <div class="buttons">
          <button class="blob-btn" @click="clearHistory">
            清空历史
            <span class="blob-btn__inner">
              <span class="blob-btn__blobs">
                <span class="blob-btn__blob"></span>
                <span class="blob-btn__blob"></span>
                <span class="blob-btn__blob"></span>
                <span class="blob-btn__blob"></span>
              </span>
            </span>
          </button>          
          <br/>
        </div>
      </div>
    </div>
    <div id="app">
      <div v-if="!isEmpty">
        <!-- 浏览 -->
        <div v-if="showBrowsingHistory">
        <div v-if="today.length > 0">
          <h2>今天</h2>
          <h3>Today</h3>
          <ul>
            <li v-for="item in today" :key="item.exam_id || item.work_id">
              <div class="times"v-if="item">
                <div class="history-red-round">
                  <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                </div>
                <div class="item-date">{{ formatDate(item.view_date) }}</div>
              </div>
              <div class="items">
                <div class="item-content"@click="navigateToPage(item)">
                <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                <div class="item-type">{{ item.exam_type || item.work_type }}</div>
              </div>
                <div class="del" @click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')"style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                  <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                </div>               
              </div>
            </li>
          </ul>
        </div>
        <div v-if="yesterday.length > 0">
          <h2>昨天</h2>
          <h3>Yesterday</h3>
          <ul>
            <li v-for="item in yesterday" :key="item.exam_id || item.work_id">
            <div class="times">
              <div class="history-red-round">
                <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
              </div>
              <div class="item-date">{{ formatDate(item.view_date) }}</div>
            </div>
            <div class="items">
              <div class="item-content"@click="navigateToPage(item)">
              <div class="item-name">{{ item.exam_name || item.work_name }}</div>
              <div class="item-type">{{ item.exam_type || item.work_type }}</div>
            </div>
              <div class="del"@click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
              </div>
              
            </div>
            </li>
          </ul>
        </div>
        <div v-if="last7days.length > 0">
          <h2>七天内</h2>
          <h3>Previous 7 Days</h3>
          <ul>
            <li v-for="item in last7days" :key="item.exam_id || item.work_id">
              <div class="times">
                <div class="history-red-round"@click="navigateToPage(item)">
                  <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                </div>
                <div class="item-date">{{ formatDate(item.view_date) }}</div>
              </div>
              <div class="items">
                <div class="item-content">
                <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                <div class="item-type">{{ item.exam_type || item.work_type }}</div>
              </div>
                <div class="del"@click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                  <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                </div>
                
              </div>
            </li>
          </ul>
        </div>
        <div v-if="last30days.length > 0">
          <h2>一个月内</h2>
          <h3>Previous 30 Days</h3>
          <ul>
            <li v-for="item in last30days" :key="item.exam_id || item.work_id">
              <div class="times">
                <div class="history-red-round">
                  <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                </div>
                <div class="item-date">{{ formatDate(item.view_date) }}</div>
              </div>
              <div class="items">
                <div class="item-content"@click="navigateToPage(item)">
                <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                <div class="item-type">{{ item.exam_type || item.work_type }}</div>
              </div>
                <div class="del"@click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                  <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                </div>
                
              </div>
            </li>
          </ul>
        </div>
        <div v-if="earlier.length > 0">
          <h2>更早</h2>
          <h>More</h>
          <ul>
            <li v-for="item in earlier" :key="item.exam_id || item.work_id">
              <div class="times">
                <div class="history-red-round">
                  <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                </div>
                <div class="item-date">{{ formatDate(item.view_date) }}</div>
              </div>
              <div class="items">
                <div class="item-content"@click="navigateToPage(item)">
                <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                <div class="item-type">{{ item.exam_type || item.work_type }}</div>
              </div>
                <div class="del"@click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                  <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                </div>
                
              </div>
            </li>
          </ul>
        </div>  
        </div>
        <!-- 搜索 -->
        <div v-else-if="showSearchResult">
          <div v-if="searchResult.length > 0">
            <div v-if="todaySearch.length > 0">
              <h2>今天</h2>
              <h3>Today</h3>
              <ul>
                <li v-for="item in todaySearch" :key="item.exam_id || item.work_id">
                  <div class="times">
                    <div class="history-red-round">
                      <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                    </div>
                    <div class="item-date">{{ formatDate(item.view_date) }}</div>
                  </div>
                  <div class="items">
                    <div class="item-content"@click="navigateToPage(item)">
                    <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                    <div class="item-type">{{ item.exam_type || item.work_type }}</div>
                    </div>
                    <div class="del" @click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                      <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                    </div>
                    
                  </div>
                </li>
              </ul>
            </div>
            <div v-if="yesterdaySearch.length > 0">
              <h2>昨天</h2>
              <h3>Yesterday</h3>
              <ul>
                <li v-for="item in yesterdaySearch" :key="item.exam_id || item.work_id">
                  <div class="times">
                    <div class="history-red-round">
                      <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                    </div>
                    <div class="item-date">{{ formatDate(item.view_date) }}</div>
                  </div>
                  <div class="items">
                    <div class="item-content"@click="navigateToPage(item)">
                    <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                    <div class="item-type">{{ item.exam_type || item.work_type }}</div>
                  </div>
                    <div class="del" @click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                      <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                    </div>
                    
                </li>
              </ul>
            </div>
            <div v-if="last7daysSearch.length > 0">
              <h2>七天内</h2>
              <h3>Previous 7 Days</h3>
              <ul>
                <li v-for="item in last7daysSearch" :key="item.exam_id || item.work_id">
                  <div class="times">
                    <div class="history-red-round">
                      <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                    </div>
                    <div class="item-date">{{ formatDate(item.view_date) }}</div>
                  </div>
                  <div class="items">
                    <div class="item-content"@click="navigateToPage(item)">
                    <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                    <div class="item-type">{{ item.exam_type || item.work_type }}</div>
                  </div>
                    <div class="del"@click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                      <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                    </div>
                </li>
              </ul>
            </div>
            <div v-if="last30daysSearch.length > 0">
              <h2>一个月内</h2>
              <h3>Previous 30 Days</h3>
              <ul>
                <li v-for="item in last30daysSearch" :key="item.exam_id || item.work_id">
                  <div class="times">
                    <div class="history-red-round">
                      <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                    </div>
                    <div class="item-date">{{ formatDate(item.view_date) }}</div>
                  </div>
                  <div class="items">
                    <div class="item-content"@click="navigateToPage(item)">
                    <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                    <div class="item-type">{{ item.exam_type || item.work_type }}</div>
                  </div>
                    <div class="del" @click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')" style="margin-right:20px;width:20px;height:20px;margin-top:10px">
                      <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                    </div>
                </li>
              </ul>
            </div>
            <div v-if="earlierSearch.length > 0">
              <h2>更早</h2>
              <h3>More</h3>
              <ul>
                <li v-for="item in earlierSearch" :key="item.exam_id || item.work_id">
                  <div class="times">
                    <div class="history-red-round">
                      <img src="assets/img/time.png"style="filter: invert(99%) sepia(0%) saturate(2%) hue-rotate(210deg) brightness(103%) contrast(100%);width:100%;height:100%;"alt="">
                    </div>
                    <div class="item-date">{{ formatDate(item.view_date) }}</div>
                  </div>
                  <div class="items">
                    <div class="item-content"@click="navigateToPage(item)">
                    <div class="item-name">{{ item.exam_name || item.work_name }}</div>
                    <div class="item-type">{{ item.exam_type || item.work_type }}</div>
                  </div>
                    <div class="del" @click="deleteHistory(item.exam_id? item.exam_id : item.work_id, item.exam_id ? 'exam_id' : 'work_id')"style="margin-right:20px;width:20px;height:20px;margin-top:10px"alt="">
                      <img src="assets/img/delete.png" style="width:100%;height:100%"alt="">
                    </div>
                </li>
              </ul>
            </div>
          </div>
          <div v-else style="display: flex;justify-content: space-between;width:70%;margin:0 auto;">
            <div style="margin-top:20%">
              <p style="font-size: 35px;height:50px">没找到相关历史记录</p>
              <p style="font-size: 35px;height:50px"@click="fetchData">查看全部历史记录</p>
            </div>
            <img src="assets/img/browse.png" style="width:50%;height:50%;margin:0 auto"alt="">
          </div>
        </div>
        <p v-if="moreToLoad" @click="fetchData" style="text-align: center;">加载更多...</p>
        <p v-else style="text-align: center;">全部数据加载完毕</p>
      </div>
      <div v-else style="display: flex;justify-content: space-between;width:70%;margin:0 auto;">
        <div style="margin-top:20%">
          <p style="font-size: 35px;height:50px">历史记录空空如也</p>
          <p style="font-size: 35px;height:50px"><a href="../../oo/index.html">快去学习吧!</a></p>
        </div>
        <img src="assets/img/browse.png" style="width:50%;height:50%;margin:0 auto"alt="">
      </div>
    </div>
  </section>
</div>
<!-- End Content -->
<!-- Toggle menu -->
<div class="menus">
    <a class="hover-target" href="../../oo/index.html">首页</a>
    <a class="hover-target" href="modify.html">修改个人信息</a>
    <a class="hover-target" href="about.html">个人中心</a>
    <a class="hover-target" href="index-2.html">收藏</a>
    <a class="hover-target" href="index-3.html">喜欢</a>
    <a class="hover-target" href="work-detail.html">离线缓存</a>
    <button class="hover-target rm"id="byebye">退出登录</button>
  </div>
  <div class="menu__toggler hover-target magnetic"><span></span></div>
<!-- Cursor -->
<div class="cursor1" id="cursor1"></div>
<div class="cursor" id="cursor"></div>
<script src="https://www.jq22.com/jquery/jquery-3.3.1.js"></script>
<script src="assets/js/plugin.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@0.21.1"></script>
<script>
  new Vue({
    el: '#app',
    data() {
      return {
        page:1,
        showBrowsingHistory: true,
        showSearchResult: false,
        history: [],
        today: [],
        yesterday: [],
        last7days: [],
        last30days: [],
        earlier: [],
        searchKeyword: '',
        searchResult: [],
        todaySearch: [],
        yesterdaySearch: [],
        last7daysSearch: [],
        last30daysSearch: [],
        earlierSearch: [],
        loading:false,
        moreToLoad: false
      };
    },
    mounted() {
      this.$on('searchPerformed', () => {
            this.showSearchResult = true;
            this.showBrowsingHistory = false;
        });
      this.$root.$on('searchResultUpdated', (searchResult) => {
      this.searchResult = searchResult;
    });
      this.fetchData();
      window.addEventListener('scroll', this.checkScroll);
      this.deleteHistory();
    },
    methods: {
      navigateToPage(item) {
    if (item.exam_id && item.exam_type) {
      window.location.href = `../../../../oo/exam/exam/test/html/exam_id_${item.exam_id}.html`;
    } else if (item.work_id && item.work_name) {
      window.location.href = `../../../../oo/exam/exam/test/html/work_id_${item.work_id}.html`;
    }
  },
      checkScroll() {
        if (!this.isLoading && !this.isEnd) {
    window.requestAnimationFrame(() => {
      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
        this.fetchData();
      }
    });
  }
      },
      fetchData() {
  if (this.moreToLoad || this.loading) return;
  this.loading = true;
  const token = localStorage.getItem('token');
  fetch(`http://49.234.190.148:8888/course/browsing_historyView/?page=${this.page}`, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'token': token
    },
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(response => {
    if (response.detail === "无效页面。") {
      this.moreToLoad= true;
    } else {
      this.history.push(...response.msg);
      if (response.msg.length === 0) {
        this.moreToLoad = true;
      } else {
        this.page++;
      }
    }
  })
  .catch(error => {
    console.error('Failed to fetch history:', error);
  })
  .finally(()=>{
    this.filterHistory();
    this.loading=false;
  });
},
deleteHistory(id, type) {
  const token = localStorage.getItem('token');
  const data = {};
  data[type] = id;
  console.log('单个删除');
  axios.delete(`http://49.234.190.148:8888/course/browsing_historyDeleteView/`, {
    headers: {
      'token': token
    },
    data: data
  })
  .then(() => {
    this.history = this.history.filter(item => item.id !== id);
    this.filterHistory();
    this.$forceUpdate();
  })
  .catch(error => {
    console.error('Failed to delete history:', error);
  });
},
filterSearchResult() {
        const today = new Date();
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        
        this.todaySearch = this.searchResult.filter(item => this.isSameDay(new Date(item.view_date), today));
        this.yesterdaySearch = this.searchResult.filter(item => this.isSameDay(new Date(item.view_date), yesterday));
        this.last7daysSearch = this.searchResult.filter(item => this.isInLast7Days(new Date(item.view_date)) && !this.isSameDay(new Date(item.view_date), today) && !this.isSameDay(new Date(item.view_date), yesterday));
        this.last30daysSearch = this.searchResult.filter(item => this.isInLast30Days(new Date(item.view_date)) && !this.isSameDay(new Date(item.view_date), today) && !this.isSameDay(new Date(item.view_date), yesterday) && !this.isInLast7Days(new Date(item.view_date)));
        this.earlierSearch = this.searchResult.filter(item => !this.isSameDay(new Date(item.view_date), today) && !this.isSameDay(new Date(item.view_date), yesterday) && !this.isInLast7Days(new Date(item.view_date)) && !this.isInLast30Days(new Date(item.view_date)));
        this.todaySearch.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.yesterdaySearch.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.last7daysSearch.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.last30daysSearch.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.earlierSearch.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
},
filterHistory() {
        this.showBrowsingHistory = true;
        this.showSearchResult = false;
        const today = new Date();
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        
        this.today = this.history.filter(item => this.isSameDay(new Date(item.view_date), today));
        this.yesterday = this.history.filter(item => this.isSameDay(new Date(item.view_date), yesterday));
        this.last7days = this.history.filter(item => this.isInLast7Days(new Date(item.view_date)) && !this.isSameDay(new Date(item.view_date), today) && !this.isSameDay(new Date(item.view_date), yesterday));
        this.last30days = this.history.filter(item => this.isInLast30Days(new Date(item.view_date)) && !this.isSameDay(new Date(item.view_date), today) && !this.isSameDay(new Date(item.view_date), yesterday) && !this.isInLast7Days(new Date(item.view_date)));
        this.earlier = this.history.filter(item => !this.isSameDay(new Date(item.view_date), today) && !this.isSameDay(new Date(item.view_date), yesterday) && !this.isInLast7Days(new Date(item.view_date)) && !this.isInLast30Days(new Date(item.view_date)));
  
        this.today.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.yesterday.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.last7days.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.last30days.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
        this.earlier.sort((a, b) => new Date(b.view_date) - new Date(a.view_date));
      },
      isSameDay(date1, date2) {
        return date1.getFullYear() === date2.getFullYear() && date1.getMonth() === date2.getMonth() && date1.getDate() === date2.getDate();
      },
      isInLast7Days(date) {
        const last7days = new Date();
        last7days.setDate(last7days.getDate() - 7);
        return date > last7days;
      },
      isInLast30Days(date) {
        const last30days = new Date();
        last30days.setDate(last30days.getDate() - 30);
        return date > last30days;
      },
      formatDate(dateStr) {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}`;
      }
    },
    computed: {
      isEmpty() {
        return this.history.length === 0;
      }
    },
    beforeDestroy() {
      window.removeEventListener('scroll', this.checkScroll);
    }
  })
  </script>
  <script>
const token=localStorage.getItem('token');
    new Vue({
      el: '#epp',
      data(){
        return{
          searchKeyword: '',
          searchResult: []
        };
      },
      methods: {
        handleSearch() {
  this.$emit('searchPerformed');
  console.log('搜索')
  const keyword = this.searchKeyword.trim();
  if (keyword === '') {
    return;
  }
  
  const token = localStorage.getItem('token');

  axios.post(`http://49.234.190.148:8888/course/browsing_historySearchView/`, { keyword }, {
    headers: {
      'token': token
    }
  })
  .then(response => {
    if (response.data.msg === '没有查找到，换个关键词试试') {
      this.searchResult.length = 0;
    } else {
      this.searchResult = response.data.msg;
      this.$root.$emit('searchResultUpdated', this.searchResult);
      this.filterSearchResult();
    }
  })
  .catch(error => {
    console.error('Failed to fetch search result:', error);
  });
},
        clearHistory() {
        console.log('清空历史')
        axios.delete('http://49.234.190.148:8888/course/browsing_historyAllDeleteView/',{
          headers:{
            'token': token
          }
        })
          .then(response => {
            this.history = [];
            this.filterHistory();
            this.moreToLoad = false;
            location.reload();
          })
          .catch(error => {
          console.error('Failed to clear history:', error);
          });
}
      }
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
    const logoutButton = document.getElementById('byebye');
    logoutButton.addEventListener('click', function() {
      localStorage.removeItem('userData');
    localStorage.removeItem('token');
      window.location.href = "../../login/log/log.html";
    });
  });
  </script>
</body>
</html>