<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="stylesheet" href="assets/css/main.css">
<link rel="stylesheet" href="assets/css/responsive.css">
<link rel="stylesheet" href="assets/css/work.css">
<style>
  .item-name,.item-type{
    z-index: 2;
  }
  
  .grid-container {
    display: grid;
    grid-template-columns: 1fr;
    grid-gap: 20px;
    padding: 20px;
    margin: 0 auto;
    max-width: 1200px; 
  }
.text-folio{
  position: absolute;
  top: calc(100% - 20px); 
  left: 50%;
  transform: translateX(-50%);
  white-space: nowrap;
}
.text-1 {
	position:absolute;
	font-family:'Poppins',sans-serif!important;
	color:transparent!important;
	font-weight:900;
	font-size:30px;
	letter-spacing:2px;
	-webkit-text-stroke:1px #fff;
	z-index:4!important;
	left:50%;
	top:85%;
	transform:translateX(-50%);
	-webkit-transform:translateX(-50%);
	-moz-transform:translateX(-50%);
	-ms-transform:translateX(-50%);
	-o-transform:translateX(-50%)
}
.text-2 {
	position:absolute;
	font-family:'Poppins',sans-serif!important;
	color:#4b70e24a!important;
	font-weight:900;
	font-size:30px;
	letter-spacing:2px;
	z-index:1;
	left:50%;
	top:85%;
	transform:translateX(-50%);
	-webkit-transform:translateX(-50%);
	-moz-transform:translateX(-50%);
	-ms-transform:translateX(-50%);
	-o-transform:translateX(-50%)
}
  .grid-item {
    position: relative;
    transition: transform 0.5s ease;
    padding:50px;
    z-index: 2;
    background-color: #eee;
    color: #000;
    border-radius: 5px;
    text-align: center;
    width: 100%;
    box-shadow: 4px 6px 8px 3px rgb(135 135 135 / 29%);
  }

  #grid-item:hover {
  color:#4B70E2;
  cursor: pointer!important;
  transform: translateY(-20px);

  }
  .grid-item:nth-child(4n+1),
  .grid-item:nth-child(4n+4) {
    height: 150px;
    margin-bottom: 50px;
  }

  .grid-item:nth-child(4n+2),
  .grid-item:nth-child(4n+3) {
    height: 200px;
    margin-bottom: 50px;
  }

  .grid-item:nth-child(4n+3) {
    margin-top: -50px;
  }
  @media only screen and (min-width: 768px) {
    .grid-container {
      grid-template-columns: 1fr 1fr;
    }
  }
</style>
</head>
<body>
<!-- Start Preload -->
<div class="preloader"></div>
<div class="block-1"></div>
<div class="block-2"></div>
<div class="logo-load"><img src="assets/img/logo1.svg" alt=""></div>
<div class="logo-load spinning"></div>
<div class="over-all"></div>
<!-- End Preload --><!-- Start Header -->
<header>
  <nav><!-- Logo -->
    <div class="logo hover-target"><a class="load-spiral" href="index.html"><img src="assets/img/logo.svg" alt="logo"></a></div>
    <!-- Menu bar -->
    <div class="toggle-btn magnetic hover-target">
      <div class="burger-menu"><span class="one"></span><span class="two"></span><span class="tre"></span></div>
    </div>
    <!-- Social -->
    <div class="scr socials">
      <div class="list-social">
        <ul>
            <li class="hover-target"><a href="#">COUSE.</a></li>
            <li class="hover-target"><a href="#">R.</a></li>
            <li class="hover-target"><a href="#">Q.</a></li>
            <li class="hover-target"><a href="#">A.</a></li>
        </ul>
      </div>
    </div>
    <!-- Copyright -->
    <div class="scr copyright-top">
      <p>教育 &copy;2024</p>
    </div>
    <div class="bg-nav"></div>
    <!-- menu -->
    <div class="manu-container">
        <div class="menu">
          <div class="data">
            <div class="container">
              <div class="row">
                <div class="col-md-6">
                  <div class="links text-center text-lg-left">
                    <ul>
                      <li>
                        <p>01</p>
                        <a class="menu-link hover-target load-spiral" href="index-2.html">收藏</a></li>
                      <li>
                        <p>02</p>
                        <a class="menu-link hover-target load-spiral" href="index-3.html">喜欢</a></li>
                      <li>
                        <p>03</p>
                        <a class="menu-link hover-target load-spiral" href="work.html">浏览记录</a></li>
                      <li>
                        <p>04</p>
                        <a class="menu-link hover-target load-spiral" href="work-detail.html">离线缓存</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </nav>
</header>
<!-- End Header --><!-- Start Content -->
<div id="spiral"><!-- Header -->
  <div class="scrolls"><img draggable="false" src="assets/img/sroll.svg" alt="scroll"></div>
  <div class="main-head centered luxy-el" data-speed-y="5" data-offset="0">
    <div id="headmove"></div>
    <div class="fond"></div>
    <div class="container">
      <div class="row">
        <div class="col-md-8 offset-md-2">
          <h3 class="detail-pinyin"style="letter-spacing: 8px;color: #646464;">xǐ huān</h3>
          <h3 class="detail-title"style="color: #646464;">喜 欢</h3>
          <h3 class="detail-title"style="color: #646464;">like</h3>
        </div>
      </div>
    </div>
  </div>
  <section class="bg-darks">
    <div class="head">
      <div class="head-left">
        <h1>喜欢</h1>
      </div>
    </div>
    <div id="app">
      <div v-if="!isEmpty">
      <div class="grid-container">
        <div class="grid-item" id="grid-item"v-for="item in sortedItems" :key="item.id"@click="navigateToPage(item)">
          <div class="item-name">{{ item.exam_name || item.work_name }}</div>
          <div class="item-type">{{ item.exam_type || item.work_type }}</div>
          <div class="text-folio text-center">
            <h2 class="text-1">{{formatDate(item.time)}}</h2>
            <h2 class="text-2">{{formatDate(item.time)}}</h2>
          </div>
        </div>
      </div>
      <div v-if="isLoading && !isEnd" class="loading" style="text-align: center; color: #fff">
        正在加载...
      </div>      
      <div v-if="!isLoading && !isEmpty && items.length >= 0" class="end"style="text-align: center;color:#fff">
        已经到底了
      </div>
    </div>
      <div v-else style="display: flex; justify-content: space-between; width:70%; margin:0 auto;">
        <div style="margin-top:20%">
          <p style="font-size: 35px; height:50px">这里什么都没有...</p>
          <p style="font-size: 35px; height:50px"><a href="../../oo/index.html">快去学习吧!</a></p>
        </div>
        <img src="assets/img/browse.png" style="width:50%; height:50%; margin:0 auto" alt="">
      </div>
    </div>
    
  </section>
</div>
<!-- End Content --><!-- Toggle menu -->
<div class="menus">
    <a class="hover-target" href="../../oo/index.html">首页</a>
    <a class="hover-target" href="about.html">个人中心</a>
    <a class="hover-target" href="modify.html">修改个人信息</a>
    <a class="hover-target" href="index-2.html">收藏</a>
    <a class="hover-target" href="work.html">浏览记录</a>
    <a class="hover-target" href="work-detail.html">离线缓存</a>
    <button class="hover-target rm"id="byebye">退出登录</button>
  </div>
  <div class="menu__toggler hover-target magnetic"><span></span></div>
<!-- Cursor -->
<div class="cursor1" id="cursor1"></div>
<div class="cursor" id="cursor"></div>
<script src="https://www.jq22.com/jquery/jquery-3.3.1.js"></script>
<script src="assets/js/plugin.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<script>
  new Vue({
    el: '#app',
    data: {
      items: [],
      isLoading: false,
      isEmpty: false,
      isEnd: false,
      page:1
    },
    mounted() {
      this.fetchData();
      window.addEventListener('scroll', this.handleScroll);
    },
    methods: {
      navigateToPage(item) {
    if (item.exam_id && item.exam_type) {
      window.location.href = `../../../../oo/exam/exam/test/html/exam_id_${item.exam_id}.html`;
    } else if (item.work_id && item.work_name) {
      window.location.href = `../../../../oo/exam/exam/test/html/work_id_${item.work_id}.html`;
    }
  },
  fetchData() {
  if (this.isEnd || this.isLoading) return;
  this.isLoading = true;
  const token = localStorage.getItem('token');
  fetch(`http://49.234.190.148:8888/course/UserLikeView/?page=${this.page}`, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'token': token
    },
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(response => {
    if (response.detail === "无效页面。") {
      this.isEnd = true;
    } else {
      this.items.push(...response.data);
      this.sortItemsByTime();
      if (response.data.length === 0) {
        this.isEnd = true;
      } else {
        this.page++;
      }
    }
  })
  .catch(error => {
    console.error('There was a problem with your fetch operation:', error);
  })
  .finally(() => {
    this.isLoading = false;
  });
},

handleScroll() {
  if (!this.isLoading && !this.isEnd) {
    window.requestAnimationFrame(() => {
      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
        this.fetchData();
      }
    });
  }
},


      sortItemsByTime() {
        this.items.sort((a, b) => new Date(b.time) - new Date(a.time));
        const map = new Map();
        this.items.forEach(item => {
          const time = item.time;
          if (!map.has(time)) {
            map.set(time, []);
          }
          map.get(time).push(item);
        });
        this.items = Array.from(map.values()).flat();
      },
      formatDate(dateStr) {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const day = date.getDate().toString().padStart(2, '0');
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}`;
      }
    },
    computed: {
      sortedItems() {
        return this.items;
      }
    },
    watch: {
      items() {
        this.isEmpty = this.items.length === 0;
      }
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
  const logoutButton = document.getElementById('byebye');
  logoutButton.addEventListener('click', function() {
    localStorage.removeItem('userData');
  localStorage.removeItem('token');
    window.location.href = "../../login/log/log.html";
  });
});
</script>

</body>
</html>